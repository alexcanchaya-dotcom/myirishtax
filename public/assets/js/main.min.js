const faqItems = document.querySelectorAll\1'.faq-item'\1\1faqItems.forEach\1\1item\1index\1=>\1const question = item.querySelector\1'.faq-question'\1\1const answer = item.querySelector\1'.faq-answer'\1\1const toggle = item.querySelector\1'.faq-toggle'\1\1if\1!question || !answer\1return\1const answerId = answer.id || `faq-answer-$\1index + 1\1`\1answer.id = answerId\1question.setAttribute\1'aria-controls'\1answerId\1\1const isInitiallyActive = item.classList.contains\1'active'\1\1answer.hidden = !isInitiallyActive\1question.addEventListener\1'click'\1\1\1=>\1const isActive = item.classList.toggle\1'active'\1\1question.setAttribute\1'aria-expanded'\1isActive ? 'true'\1'false'\1\1answer.hidden = !isActive\1if\1toggle\1toggle.textContent = isActive ? '–'\1'+'\1\1\1\1\1\1\1const navLinks = document.querySelectorAll\1'.nav-links a[href^="#"]'\1\1navLinks.forEach\1\1link\1=>\1link.addEventListener\1'click'\1\1e\1=>\1const target = document.querySelector\1link.getAttribute\1'href'\1\1\1if\1target\1\1e.preventDefault\1\1\1target.scrollIntoView\1\1behavior\1'smooth'\1\1\1\1\1\1\1\1\1\1function toggleCookieBanner\1show\1\1const banner = document.getElementById\1'cookie-banner'\1\1if\1!banner\1return\1if\1show\1\1banner.classList.add\1'show'\1\1\1else\1banner.classList.remove\1'show'\1\1\1\1const consent = localStorage.getItem\1'mit-consent'\1\1if\1!consent\1\1setTimeout\1\1\1=> toggleCookieBanner\1true\1\1900\1\1\1document.getElementById\1'accept-cookies'\1?.addEventListener\1'click'\1\1\1=>\1localStorage.setItem\1'mit-consent'\1'accepted'\1\1toggleCookieBanner\1false\1\1\1\1\1document.getElementById\1'reject-cookies'\1?.addEventListener\1'click'\1\1\1=>\1localStorage.setItem\1'mit-consent'\1'rejected'\1\1toggleCookieBanner\1false\1\1\1\1\1const calculatorForm = document.getElementById\1'tax-calculator'\1\1const resultsContainer = document.getElementById\1'results'\1\1const taxYearSelect = document.getElementById\1'tax-year'\1\1const creditsInput = document.getElementById\1'credits'\1\1const secondaryIncomeInput = document.getElementById\1'secondary-income'\1\1const taxYearCache = new Map\1\1\1function formatEuro\1amount\1\1return `€$\1amount.toFixed\12\1\1`\1\1async function fetchJson\1url\1options\1\1const response = await fetch\1url\1options\1\1if\1!response.ok\1throw new Error\1`Request failed\1$\1response.status\1`\1\1return response.json\1\1\1\1async function loadTaxYearOptions\1\1\1if\1!taxYearSelect\1return\1try\1const\1years\1= await fetchJson\1'/api/tax/config'\1\1taxYearSelect.innerHTML = ''\1years.forEach\1\1entry\1=>\1const option = document.createElement\1'option'\1\1option.value = entry.year\1option.textContent = entry.year\1taxYearSelect.appendChild\1option\1\1\1\1\1const latest = years.at\1-1\1\1if\1latest\1\1taxYearSelect.value = latest.year\1const config = await ensureTaxYearConfig\1latest.year\1\1applyDefaultCredits\1config\1\1\1\1catch\1err\1\1console.error\1'Unable to load tax years'\1err\1\1\1\1async function ensureTaxYearConfig\1year\1\1if\1taxYearCache.has\1year\1\1return taxYearCache.get\1year\1\1const data = await fetchJson\1`/api/tax/config/$\1year\1`\1\1taxYearCache.set\1year\1data\1\1return data\1\1function applyDefaultCredits\1config\1\1if\1!creditsInput || !config?.income_tax?.credits\1return\1const defaultCredits =\1config.income_tax.credits.personal || 0\1+\1config.income_tax.credits.paye || 0\1\1creditsInput.value = defaultCredits\1\1function renderWarnings\1warnings = []\1\1if\1!warnings.length\1return ''\1const items = warnings.map\1\1warning\1=> `<li>$\1warning\1</li>`\1.join\1''\1\1return `<div class="card warning"><h3>Guardrails</h3><ul class="features">$\1items\1</ul></div>`\1\1function renderBreakdown\1liabilities = []\1\1return liabilities .filter\1\1item\1=> item.type !== 'bik'\1.map\1\1item\1=> `<li>$\1item.type.toUpperCase\1\1\1\1$\1formatEuro\1item.liability || 0\1\1</li>`\1.join\1''\1\1\1calculatorForm?.addEventListener\1'change'\1async\1e\1=>\1if\1e.target === taxYearSelect && taxYearSelect.value\1\1try\1const config = await ensureTaxYearConfig\1taxYearSelect.value\1\1applyDefaultCredits\1config\1\1\1catch\1err\1\1console.error\1'Unable to load selected year'\1err\1\1\1\1\1\1\1calculatorForm?.addEventListener\1'submit'\1async\1e\1=>\1e.preventDefault\1\1\1if\1!resultsContainer || !taxYearSelect\1return\1const taxYear = taxYearSelect.value\1const income = Number\1calculatorForm.income.value\1|| 0\1const secondaryIncome = Number\1secondaryIncomeInput?.value\1|| 0\1const creditsValue = creditsInput?.value ?? ''\1const credits = creditsValue === '' ? null\1Number\1creditsValue\1\1const includeUSC = calculatorForm.usc.value === 'yes'\1const includePRSI = calculatorForm.prsi.value === 'yes'\1const week1Month1Basis = calculatorForm['week1-month1']?.checked || false\1try\1const payload =\1taxYear\1employments\1[income\1secondaryIncome]\1taxCredits\1Number.isFinite\1credits\1? credits\1null\1includeUSC\1includePRSI\1week1Month1Basis\1\1const\1result\1= await fetchJson\1'/api/tax/calculate'\1\1method\1'POST'\1headers\1\1'Content-Type'\1'application/json'\1\1body\1JSON.stringify\1payload\1\1\1\1const warningBlock = renderWarnings\1result.warnings\1\1resultsContainer.innerHTML = ` <div class="card"> <h3>Summary\1$\1result.configMeta.year\1\1</h3> <p><strong>Estimated net pay\1</strong> $\1formatEuro\1result.summary.netIncome\1\1</p> <p><strong>Total deductions\1</strong> $\1formatEuro\1result.summary.totalLiability\1\1</p> </div> <div class="card"> <h3>Breakdown</h3> <ul class="features">$\1renderBreakdown\1result.liabilities\1\1</ul> <p class="meta">Runtime config driven by Revenue-style thresholds. Use as guidance only.</p> </div> $\1warningBlock\1`\1\1catch\1err\1\1resultsContainer.innerHTML = `<div class="card warning"><h3>Calculation error</h3><p>$\1err.message\1</p></div>`\1\1\1\1\1loadTaxYearOptions\1\1\1